<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="css/jquery.mobile-1.4.1.min.css" />
	
	<link rel="stylesheet" href="css/themes/ccn20.min.css" />
	<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
	
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.mobile-1.4.1.min.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/function_checkConnection.js"></script>
	<!-- cordova facebook plugin -->
	<script src="cdv-plugin-fb-connect.js"></script>
	<!-- facebook js sdk -->
	<script src="facebook-js-sdk.js"></script>
</head>
<body>

<!-- PAGE #opzioni -->
<div data-role="page" id="opzioni">

	<!-- /HEADER -->
	<div data-role="header">
		<h1>Opzioni</h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<div id="fb-root"></div>
	<script>
  
	$( "#opzioni" ).on( "pagebeforeshow", function() {	
	
	//FACEBOOK
	FB.init({ appId: "1448410138727682", nativeInterface: CDV.FB, useCachedDialogs: false });
		//GET LOGIN STATUS
		FB.getLoginStatus(function(response) {
	
			//CONNESSO
			if (response.status === 'connected') {
			$("li.facebook").html('<button class="facebook ui-btn ui-shadow" buttonAction="logout">logout</button>');
			}
			//APP NON AUTORIZZATA
			else if (response.status === 'not_authorized') {
			$("li.facebook").html('<button class="facebook ui-btn ui-shadow" buttonAction="login">login</button>');
			} 
			//NON CONNESSO
			else {
			$("li.facebook").html('<button class="facebook ui-btn ui-shadow" buttonAction="login">login</button>');
			}
		
		}, true);
		
	}); //ON "pageshow"
	
	$(document).on("click", 'button.facebook', function(){
	
	var action = $(this).attr('buttonAction');
	alert(action);
	
		if(action == "login") {
			//FACEBOOK LOGIN
			FB.login(function(response) {
            
			if (response.authResponse) {
			$("li.facebook").html('<button class="facebook ui-btn ui-shadow" buttonAction="logout">logout</button>');
			}
			else {
				alert('not logged in');
			}
			},
			{ scope: "email" }
			);
		}
		else if(action == "logout") {
			//FACEBOOK LOGOUT
			FB.logout(function(response) {
			// user is now logged out
			$("li.facebook").html('<button class="facebook ui-btn ui-shadow" buttonAction="login">login</button>');
			});
		}
	
	}); //ON "click"
	
	</script>
	
	<h1>OPTIONS</h1>
	<ul data-role="listview">
		<li class="facebook"></li>
		<li></li>
		<li></li>
		<li></li>
	</ul>
	
	</div>
	<!-- /CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-theme="a" data-position="fixed">
		<h4>Page Footer</h4>
	</div>
	<!-- /FOOTER -->
</div><!-- /PAGE #opzioni -->

</body>
</html>