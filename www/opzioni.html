<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="css/jquery.mobile-1.4.1.min.css" />
	
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.mobile-1.4.1.min.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/function_checkConnection.js"></script>
	<!-- cordova facebook plugin -->
	<script src="cdv-plugin-fb-connect.js"></script>
	<!-- facebook js sdk -->
	<script src="facebook-js-sdk.js"></script>
</head>
<body>

<!-- PAGE #opzioni -->
		<div data-role="page" id="opzioni">

		<!-- /HEADER -->
		<div data-role="header">
		<h1>Opzioni</h1>
		<a href="#" data-rel="back" id="indietro" class="jqm-navmenu-link ui-btn ui-corner-all ui-nodisc-icon ui-alt-icon ui-btn-left" data-transition="slide" data-direction="reverse">indietro</a>
		</div>
		<!-- /HEADER -->
	
		<!-- CONTENT -->
		<div role="main" class="ui-content" >
		
		<script>
		
		document.addEventListener("backbutton", function(e){
    
		if($.mobile.activePage.is('#index')){
        e.preventDefault();
        return false;
		}
		else {
        navigator.app.backHistory()
		}
		}, false);
		
		</script>
		
		<ul data-role="listview" data-inset="true">
			<li><a href="#socialNetworks" data-transition="slide"><h2>Social Networks</h2><p>Collega/scollega account</p></a></li>
			<li><a href="#lingua" data-transition="slide"><h2>Lingua</h2><p>Cambia lingua</p></a></li>
			<li><a href="#database" data-transition="slide"><h2>Database</h2><p>Aggiorna il database degli esercizi</p></a></li>
		</ul>
		
		</div>
		<!-- /CONTENT -->

		<!-- FOOTER -->
		<div data-role="footer" data-theme="a" data-position="fixed"><h4>Page Footer</h4></div>
		<!-- /FOOTER -->
		
		</div>
<!-- /PAGE #opzioni -->

<!-- PAGE #socialNetworks -->
		<div data-role="page" id="socialNetworks">

		<!-- /HEADER -->
		<div data-role="header">
		<h1>Social Networks</h1>
		<a href="#" data-rel="back" id="indietro" class="jqm-navmenu-link ui-btn ui-corner-all ui-nodisc-icon ui-alt-icon ui-btn-left" data-transition="slide" data-direction="reverse">indietro</a>
		</div>
		<!-- /HEADER -->
	
		<!-- CONTENT -->
		<div role="main" class="ui-content" >
		
		<script>
		$( "#socialNetworks" ).on( "pagebeforeshow", function() {	
		
		//FACEBOOK
			FB.init({ appId: "1448410138727682", nativeInterface: CDV.FB, useCachedDialogs: false });
			//GET LOGIN STATUS
			FB.getLoginStatus(function(response) {
				//CONNESSO
				if (response.status === 'connected') {
				alert("facebook connesso");
				$("img.imageFacebook").attr("src", "img/facebookList.png");
				}
				//APP NON AUTORIZZATA
				else if (response.status === 'not_authorized') {
				alert("facebook non connesso");
				$("img.imageFacebook").attr("src", "img/facebookListbn.png");
				} 
				//NON CONNESSO
				else {
				alert("facebook non connesso");
				$("img.imageFacebook").attr("src", "img/facebookListbn.png");
				}
			}, true);
		
		//FOURSQUARE
		var tokenFoursquare = window.localStorage.getItem("tokenFoursquare");
	
			if(tokenFoursquare == null) {
			alert("foursquare non connesso");
			$("img.imageFoursquare").attr("src", "img/foursquareListbn.png");
			}
			else {
			alert("foursquare connesso");
			$("img.imageFoursquare").attr("src", "img/foursquareList.png");
			}
		
		//TWITTER
		var twitterToken = window.localStorage.getItem("twitterToken");
	
			if(twitterToken == null) {
			alert("twitter non connesso");
			$("img.imageTwitter").attr("src", "img/twitterListbn.png");
			}
			else {
			alert("twitter connesso");
			$("img.imageTwitter").attr("src", "img/twitterList.png");
			}
		
		}); //ON "pagebeforeshow"
		
		//TWITTER
		$(document).on("click", 'a.collegaTwitter', function(){
		
		twitterToken = window.localStorage.getItem("twitterToken");
		if(twitterToken == null) {

			alert("token foursquare nullo");
			
			var ref = window.open('http://www.wificomo.com/twitter/twitterConnect.php', '_blank', 'location=no');
			ref.addEventListener('loadstart', function(event) {
			closeTwitter(event.url,ref);
			});  
	
			function closeTwitter(loc,ref) {
   
				if (loc.indexOf("www.wificomo.com/twitter/twitterTokens.php?") > -1){
				var twitterToken = loc.substring(loc.indexOf("oauth_token=")+12, loc.indexOf("&"));
				var twitterVerifier = loc.substring(loc.indexOf("oauth_verifier=")+15, loc.indexOf("&t"));
				var twitterName = loc.substring(loc.indexOf("twitterName=")+12);
				twitterName = decodeURIComponent(twitterName);
		
				window.localStorage.setItem("twitterToken", twitterToken);
				window.localStorage.setItem("twitterVerifier", twitterVerifier);
				window.localStorage.setItem("twitterName", twitterName);
		
				$("img.imageTwitter").attr("src", "img/twitterList.png");
		
				ref.close();
				}
			}
		}
		else {
		alert("elimino twitter token");
		localStorage.removeItem("twitterToken");
		localStorage.removeItem("twitterVerifier");
		localStorage.removeItem("twitterName");
		$("img.imageTwitter").attr("src", "img/twitterListbn.png");
		}	
		
		});
		
		/*
		//FOURSQUARE
		$(document).on("click", 'a.collegaFoursquare', function(){
		
			tokenFoursquare = window.localStorage.getItem("tokenFoursquare");
			if(tokenFoursquare == null) {
			
			alert("token foursquare nullo");
			
				var ref = window.open('https://foursquare.com/oauth2/authenticate?client_id=4P4XY5XMV2EEGL4THQFXJFMJBTJN4WBNX1VIQGAUWDPHYZZF&response_type=token&redirect_uri=http://www.wificomo.com/ccn20/closeFoursquare.html', '_blank', 'location=no');
				ref.addEventListener('loadstart', function(event) {
				closeFoursquare(event.url,ref);
				}); 
			}
			else {
			alert("elimino twitter foursquare");
			localStorage.removeItem("tokenFoursquare");
			$("a.collegaFoursquare").html('<img src="img/foursquareListListbn.png" alt="Foursquare" class="imageFoursquare ui-li-icon ui-corner-none">Foursquare');
			}
		
			function closeFoursquare(loc,ref) {
   
			if (loc.indexOf("www.wificomo.com/ccn20/closeFoursquare.html#") > -1){
			var tokenFoursquare = loc.substring(loc.indexOf("=")+1);
			window.localStorage.setItem("tokenFoursquare", tokenFoursquare);
			
				$.getJSON('https://api.foursquare.com/v2/users/self?oauth_token='+tokenFoursquare+'&v=20140304', function(data){
				var user = data['response']['user']['firstName'];
				$("a.collegaFoursquare").html('<img src="img/foursquareListList.png" alt="Foursquare" class="imageFoursquare ui-li-icon ui-corner-none">Foursquare ('++')');
				});
				
			ref.close();
			}
		}		
		
		}); //ON "click" button.foursquareLogin
		
		//FACEBOOK
		$(document).on("click", 'a.collegaFacebook', function(){
		
			//GET LOGIN STATUS
			FB.getLoginStatus(function(response) {
				//CONNESSO
				if (response.status === 'connected') {
					FB.logout(function(response) {
					$("img.imageFacebook").attr("src", "img/facebookListbn.png");
					});
				}
				//APP NON AUTORIZZATA
				else if (response.status === 'not_authorized') {
					FB.login(function(response) {      
						if (response.authResponse) {
						
							FB.api('/me', function(response) {
							$("a.collegaFacebook").html('<img src="img/facebookList.png" alt="Facebook" class="imageFacebook ui-li-icon ui-corner-none">Facebook (' + response.name + ')');
							});
							
						}
						else {
						alert('not logged in');
						}
					},
					{ scope: "email" }
					);
				} 
				//NON CONNESSO
				else {
					FB.login(function(response) {      
						if (response.authResponse) {
							
							FB.api('/me', function(response) {
							$("a.collegaFacebook").html('<img src="img/facebookList.png" alt="Facebook" class="imageFacebook ui-li-icon ui-corner-none">Facebook (' + response.name + ')');
							});
							
						}
						else {
						alert('not logged in');
						}
					},
					{ scope: "email" }
					);
				}
			}, true);
		
		}); //ON "click" button.facebookLogin
		*/
	
		</script>
		
		<ul data-role="listview" data-inset="true">
			<li><a href="#" class="collegaFacebook" data-transition="slide"><img src="img/facebookList.png" alt="Facebook" class="imageFacebook ui-li-icon ui-corner-none">Facebook</a></li>
			<li><a href="#" class="collegaFoursquare" data-transition="slide"><img src="img/foursquareList.png" alt="Foursquare" class="imageFoursquare ui-li-icon ui-corner-none">Foursquare</a></li>
			<li><a href="#" class="collegaTwitter" data-transition="slide"><img src="img/twitterList.png" alt="Twitter" class="imageTwitter ui-li-icon ui-corner-none">Twitter</a></li>
		</ul>
	
		</div>
		<!-- /CONTENT -->

		<!-- FOOTER -->
		<div data-role="footer" data-theme="a" data-position="fixed"><h4>Page Footer</h4></div>
		<!-- /FOOTER -->
		
		</div>
<!-- /PAGE #socialNetworks -->

<!-- PAGE #lingua -->
		<div data-role="page" id="lingua">

		<!-- /HEADER -->
		<div data-role="header">
		<h1>Lingua</h1>
		<a href="#" data-rel="back" id="indietro" class="jqm-navmenu-link ui-btn ui-corner-all ui-nodisc-icon ui-alt-icon ui-btn-left" data-transition="slide" data-direction="reverse">indietro</a>
		</div>
		<!-- /HEADER -->
	
		<!-- CONTENT -->
		<div role="main" class="ui-content" >
	
		<script>
		$( "#lingua" ).on( "pagebeforeshow", function() {	
		
		//LISTA LINGUE
		$("ul#listaLingue").html("");
		
		$.getJSON("js/lingue.js", function( data ) {
		
			$.each(data, function(index, info) {
			$("ul#listaLingue").append($("<li></li>",{"html":"<a href='#' class='lingua' id='" + info.idLingua + "' codiceLingua='"+info.codiceLingua+"' nomeLingua='"+index+"' data-transition='slide' ><img src='img/lingue/"+info.codiceLingua+".png' alt='Facebook' class='ui-li-icon ui-corner-none'>" + info.nomeLingua + "</a>" }));
			});
	
			$("ul#listaLingue").listview("refresh");
		});
		
	}); //ON "pagebeforeshow"
	
	//ON "click"
	$(document).on("click", 'a.lingua', function(){
	
	idLingua = $(this).attr('id');
	lingua = $(this).attr('nomeLingua');
	codLingua = $(this).attr('codiceLingua');
	
	window.localStorage.setItem("lingua", lingua);
	window.localStorage.setItem("idLingua", idLingua);
	window.localStorage.setItem("codLingua", codLingua);
	
	$.mobile.changePage( "downloadLingua.html", { reloadPage: true, transition: "slide"} );
	
	}); //ON "click"
	
		</script>
		
		<ul data-role="listview" id="listaLingue" data-inset="true">
		</ul>
	
		</div>
		<!-- /CONTENT -->

		<!-- FOOTER -->
		<div data-role="footer" data-theme="a" data-position="fixed"><h4>Page Footer</h4></div>
		<!-- /FOOTER -->
		
		</div>
<!-- /PAGE #lingua -->

<!-- PAGE #pagina -->
		<div data-role="page" id="pagina">

		<!-- /HEADER -->
		<div data-role="header">
		<h1>pagina</h1>
		<a href="#" data-rel="back" id="indietro" class="jqm-navmenu-link ui-btn ui-corner-all ui-nodisc-icon ui-alt-icon ui-btn-left" data-transition="slide" data-direction="reverse">indietro</a>
		</div>
		<!-- /HEADER -->
	
		<!-- CONTENT -->
		<div role="main" class="ui-content" >
	
		</div>
		<!-- /CONTENT -->

		<!-- FOOTER -->
		<div data-role="footer" data-theme="a" data-position="fixed"><h4>Page Footer</h4></div>
		<!-- /FOOTER -->
		
		</div>
<!-- /PAGE #pagina -->

</body>
</html>