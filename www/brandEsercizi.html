<!DOCTYPE html>
<html>
<head>
	<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
	<link rel="stylesheet" href="css/jquery.mobile-1.4.1.min.css" />
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.mobile-1.4.1.min.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
	
	<title>Ricerca Brand</title>
</head>
<body>

<!-- Start of page: #brandEsercizi -->
<div data-role="page" id="brandEsercizi">

	<div data-role="header">
		<h1>Ricerca Brand</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	<ul id="cerca_negozio" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Cerca..." data-filter-theme="a">
	</ul>
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pageinit", "#brandEsercizi", function() {
	
	document.addEventListener("backbutton", function(e){
    
		navigator.app.backHistory()
		
	}, false);
	
	//CARICA JSON CATEGORIE
	var path = window.localStorage.getItem("pathSD");
	var jsonPath = path + "/brand.js";
	
		$( "#cerca_negozio" ).on( "filterablebeforefilter", function ( e, data ) {
			var $ul = $( this ),
				$input = $( data.input ),
				value = $input.val(),
				html = "";
			$ul.html( "" );
			if ( value && value.length > 1 ) {
				$ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
				$ul.listview( "refresh" );
				
				var re = $input.val();
				var matcher = new RegExp( "^" + re, "i" );
				
				$.getJSON(jsonPath, function( data ) {
		
				json_filter = $.grep(data, function(item){
				return matcher.test(item.nomeBrand); 
				}) 
			
				$.each( json_filter, function (index, info) {
					 html += "<li><a href='#eserciziBrand' class='brand' idBrand='"+info.idBrand+"' brand='"+info.nomeBrand+"' data-transition='slide' >" + info.nomeBrand + "</a></li>";
				});
				
				$ul.html( html );
				$ul.listview( "refresh" );
				$ul.trigger( "updatelayout");
				
				});
				
			}
		});
	});
	
	$(document).on("click", 'a.brand', function(){
		
	idBrand = $(this).attr('idBrand');
	brand = $(this).attr('brand');
	
	});
	</script>
		
		
	</div><!-- /content -->

	<div data-role="footer" data-theme="a">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page brandEsercizi -->


<!-- Start of page: #eserciziBrand -->
<div data-role="page" id="eserciziBrand">

	<div data-role="header">
		<h1>Ricerca Brand</h1>
		<a href="#brandEsercizi" id="indietro" class="jqm-navmenu-link ui-btn ui-corner-all ui-nodisc-icon ui-alt-icon ui-btn-left" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#eserciziBrand", function() {
	
	//CARICA JSON CATEGORIE
		
	var path = window.localStorage.getItem("pathSD");
	var jsonPath = path + "/brandEsercizi.js";
	
	$.ajax({
	url: jsonPath,
	dataType: 'json',
	async: false,
		success: function(data) {
		jsonPath = data;
		}
	});
	
	//FILTRA PER BRAND
		
		jsonPath = $.grep(jsonPath, function(v) {
			return v[brand] == idBrand;
		});
		
		jsonPath = jsonPath.sort(function (a, b) {
			a = a.nomeEsercizio
			b = b.nomeEsercizio;
			return a.localeCompare(b);
		});
	
		$("ul#listaEsercizi").html("");

		$.each(jsonPath, function(index, info) {
		$("ul#listaEsercizi").append($("<li></li>",{"html":"<a href='#vetrinaEsercizio' class='esercizio' id='"+info.idEsercizio+"' data-transition='slide' >"+info.nomeEsercizio+"</a>" }));
		});

		$("ul#listaEsercizi").listview("refresh");
		
	
	//CAMBIO ORDINAMENTO
	$( "input.ordinamento" ).change(function() {
	
	ordinamento = $(this).val();
	
	console.log("ordinamento:" + ordinamento)
	
	//window.sessionStorage.setItem('start', 2);
	//$("button#bottone").show();
	
	//window.sessionStorage.setItem("ordinamento", ordinamento);
	
	switch (ordinamento)
	{
	case "nome":
		jsonOrdinamento = jsonPath.sort(function (a, b) {
			a = a.nomeEsercizio
			b = b.nomeEsercizio;
			return a.localeCompare(b);
		});
	break;
	case "votoPopular":
	jsonOrdinamento = jsonPath.sort(function(a,b) { return parseFloat(b.Punteggio.votoPopular) - parseFloat(a.Punteggio.votoPopular) } );
	break;
	case "votoTrendy":
	jsonOrdinamento = jsonPath.sort(function(a,b) { return parseFloat(b.Punteggio.votoTrendy) - parseFloat(a.Punteggio.votoTrendy) } );
	break;
	}
	
	$("ul#listaEsercizi").html("");

		$.each(jsonPath, function(index, info) {
		$("ul#listaEsercizi").append($("<li></li>",{"html":"<a href='#vetrinaEsercizio' class='esercizio' id='"+info.idEsercizio+"' data-transition='slide' >"+info.nomeEsercizio+"</a>" }));
		});

		$("ul#listaEsercizi").listview("refresh");
	
	$('#popupNested').popup('close');
	});

	
	
	});
	
	</script>
	
	<ul id="listaEsercizi" data-role="listview">
	</ul>
	
	<!-- POPUP ORDINAMENTO -->
	<div data-role="popup" id="popupNested" data-theme="none">
		<!-- ORDINAMENTO -->
		<form id="formOrdinamento">
		<fieldset id="fieldsetOrdinamento" data-role="controlgroup" data-type="vertical">
		<input type="radio" class="ordinamento" name="ordinamento" id="nome" value="nome" checked="checked"><label for="nome">Nome</label> 
		<input type="radio" class="ordinamento" name="ordinamento" id="votoPopular" value="votoPopular"><label for="votoPopular">Popular</label> 
		<input type="radio" class="ordinamento" name="ordinamento" id="votoTrendy" value="votoTrendy"><label for="votoTrendy">Trendy</label>
		</fieldset>
		</form>
		<!-- /ORDINAMENTO -->
	</div>
	<!-- /POPUP ORDINAMENTO-->
		
	</div><!-- /content -->

	<!-- FOOTER -->
	<div data-role="footer" data-theme="a" data-position="fixed">
	<!-- NAVBAR -->
		<div data-role="navbar">
			<ul>
			<li><a id="filtro" href="#popupFiltro" data-rel="popup" data-transition="flip" data-icon="gear">Filtra</a></li>
			<li><a href="#popupNested" id="ordinamento" data-rel="popup" data-transition="flip" data-icon="gear">Ordina</a></li>
		</ul>
		</div>
	<!-- /NAVBAR -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /page eserciziBrand -->

</body>
</html>