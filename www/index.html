<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="css/themes/shopincomo.min.css" />
	<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.4.2.min.css" />
	
	<link rel="stylesheet" href="css/template.css" />
	
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.mobile-1.4.2.min.js"></script>
	
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/function_checkConnection.js"></script>
	<!-- cordova facebook plugin -->
	<script src="cdv-plugin-fb-connect.js"></script>
	<!-- facebook js sdk -->
	<script src="facebook-js-sdk.js"></script>
</head>
<body>

<!-- PAGE #index -->
<div data-role="page" id="index">

	<!-- /HEADER -->
	<div data-role="header">
	<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#index" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", function(e){
    
		navigator.app.backHistory()
		
	}, false);
	
	var lingua = window.localStorage.getItem("lingua");
	
	if (lingua == null) {
	
	//var connection = checkConnection();
	
		//if (connection != "No_network") {
		document.location.href="#lingue";
		//}
		//else {
		//alert("devi essere connesso");
		//}
	}
	});
	
	//ON "click"
	$(document).on("click", 'a.qrCode', function(){
	
	var scanner = cordova.require("cordova/plugin/BarcodeScanner");
	
	scanner.scan( function (result) {
		
		var url = result.text;
		var match = url.match(/it\/content\/(\d+)/);
		if (match) {
			idEsercizio = match[1];
			document.location.href="#vetrinaMappa";
			
		} // END MATCH
		// FINE SUCCESS SCANNER
	},function (error) { 
        console.log("Scanning failed: ", error); 
	}); //END SCANNER
	
	}); //ON "click"
		
	</script>

	<div id="manicoBorsa">
	<img src="img/manico.png">
	</div>
	<div id="rigaBorsa">
	<div class="blocco_sx"><a href="eserciziVicini.html" rel="external" data-transition="slide"><img src="img/ricercaDistanza.png"></a></div><div class="blocco_dx"><a href="categorie.html" rel="external" data-transition="slide"><img src="img/ricercaCategoria.png"></a></div>
	</div>
	<div id="rigaBorsa">
	<div class="blocco_sx"><a href="nomeEsercizi.html" rel="external" data-transition="slide"><img src="img/ricercaNegozio.png"></a></div><div class="blocco_dx"><a href="brandEsercizi.html" rel="external" data-transition="slide"><img src="img/ricercaBrand.png"></a></div>
	</div>
	
	</div>
	<!-- /CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<div data-role="navbar">
			<ul>
			<li><a href="#" class="qrCode"><img src="img/qrcode.png"></a></li>
			<li><a href="opzioni.html" rel="external" data-transition="slide"><img src="img/opzioni.png"></a></li>
			<li><a href="#credits" data-transition="flip"><img src="img/info.png"></a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
	<!-- /FOOTER -->
	
</div><!-- /PAGE #index -->

<!-- PAGE #lingue -->
	<div data-role="page" id="lingue">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>
  
	$( "#lingue" ).on( "pagebeforeshow", function() {	
	
	//LISTA LINGUE
	$("ul#listaLingue").html("");
		
		$.getJSON("js/lingue.js", function( data ) {
		
			$.each(data, function(index, info) {
			$("ul#listaLingue").append($("<li></li>",{"html":"<a href='#setupCategorie' class='lingua' id='" + info.idLingua + "' codiceLingua='"+info.codiceLingua+"' nomeLingua='"+index+"' data-transition='slide' ><img src='img/lingue/"+info.codiceLingua+".png' alt='Facebook' class='ui-li-icon ui-corner-none'>" + info.nomeLingua + "</a>" }));
			});
	
			$("ul#listaLingue").listview("refresh");
		});
	
	}); //ON "pagebeforeshow"
	
	//ON "click"
	$(document).on("click", 'a.lingua', function(){
	
	idLingua = $(this).attr('id');
	lingua = $(this).attr('nomeLingua');
	codLingua = $(this).attr('codiceLingua');
	
	window.localStorage.setItem("lingua", lingua);
	window.localStorage.setItem("idLingua", idLingua);
	window.localStorage.setItem("codLingua", codLingua);
	
	}); //ON "click"
	
	</script>

	<ul data-role="listview" id="listaLingue" data-inset="true">
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-theme="a" data-position="fixed">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #lingue -->

<!-- PAGE #setupCategorie -->
	<div data-role="page" id="setupCategorie">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#setupCategorie" ).on( "pageshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	var urlCategorie = encodeURI("http://www.wificomo.com/ccn20/JSONcategorie.php?language="+codLingua+"");	
	var fileNameCategorie = "categorie.js";
		
		var fileTransfer = new FileTransfer();
			
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory("ccn", {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileNameCategorie, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
						localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						urlCategorie,
						localPath,
						
						function(entry) {
						
								//MEMORIZZA PATH
								var directory = dirEntry.fullPath;
								var indexPath = directory.lastIndexOf("/");
								var pathSD = directory.substr(7, indexPath-7);
								pathSD = pathSD+"/ccn";
								window.localStorage.setItem('pathSD', pathSD);
								
								$("li.categorie").html("download categorie <img src='img/downloadok.png'>");
								$("li.categorie").css("color","green");
								
								getSottocategorie();
						},
						function(error) {
							console.log("download error source " + error.source);
							console.log("download error target " + error.target);
							console.log("download error code " + error.code);
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	//FUNCTION getSottocategorie()
	function getSottocategorie() {
	
		var codLingua = window.localStorage.getItem('codLingua');
		var path = window.localStorage.getItem('pathSD');
		var pathCategorie = path+"/categorie.js";
		
		$.getJSON(pathCategorie, function( data ) {
		
			var numElementi = data.length;
			
			window.sessionStorage.setItem("numElementi", numElementi);
		
			$.each(data, function(index, info) {
			
			var urlSottocategorie = encodeURI("http://www.wificomo.com/ccn20/JSONsottocategorieNegozi.php?idCategoria="+info.idCategoria+"&language="+codLingua+"");	
			var fileNameSottocategorie = info.jsonName+".js";
			var directory = "ccn";
			
			downloadSottocategorie(directory, fileNameSottocategorie, urlSottocategorie);
			});
		});
		
	} //FUNCTION getSottocategorie()
	
	//JSON RICERCA PER NOME
	
	var urlnomeEsercizi = encodeURI("http://www.wificomo.com/ccn20/JSONnomeEsercizi.php");	
	var fileNamenomeEsercizi = "nomeEsercizi.js";
	var directory = "ccn";
	var pClass = "nome";
	
	downloadJSON(directory, fileNamenomeEsercizi, urlnomeEsercizi, pClass);
	
	//JSON BRAND ESERCIZI
	
	var urlbrandEsercizi = encodeURI("http://www.wificomo.com/ccn20/JSONbrandEsercizi.php");
	var fileNamebrandEsercizi = "brandEsercizi.js";
	var directory = "ccn";
	var pClass = "brandEsercizi";
	
	downloadJSON(directory, fileNamebrandEsercizi, urlbrandEsercizi, pClass);
	
	//JSON RICERCA PER BRAND
	
	var urlbrand = encodeURI("http://www.wificomo.com/ccn20/JSONbrand.php");
	var fileNamebrand = "brand.js";
	var directory = "ccn";
	var pClass = "brand";
	
	downloadJSON(directory, fileNamebrand, urlbrand, pClass);
	
	//JSON POSITION
	
	var urlposition = encodeURI("http://www.wificomo.com/ccn20/JSONposition.php");
	var filePosition = "position.js";
	var directory = "ccn";
	var pClass = "position";
	
	downloadJSON(directory, filePosition, urlposition, pClass);
	
	//JSON DISTANCE
	
	var urldistance = encodeURI("http://www.wificomo.com/ccn20/JSONdistance.php");
	var fileDistance = "distance.js";
	var directory = "ccn";
	var pClass = "distance";
	
	downloadJSON(directory, fileDistance, urldistance, pClass);
		
	// TRADUZIONI------------------------------------------------------------------------------
	
	// T.Indietro
	window.localStorage.setItem("indietro", lingue[lingua].indietro);
	// T.Categories
	window.localStorage.setItem("Categorie", lingue[lingua].Categorie);
	// T.filtra
	window.localStorage.setItem("filtra", lingue[lingua].filtra);
	// T.ordina
	window.localStorage.setItem("ordina", lingue[lingua].ordina);
	// T.salta
	window.localStorage.setItem("salta", lingue[lingua].salta);
	
	// /TRADUZIONI----------------------------------------------------------------------------
	
	}); // ON "pageshow"
	
	//DOWNLOAD JSON FUNCTION
	function downloadJSON(directory, fileName, fileURL, pClass) {
		
		var fileTransfer = new FileTransfer();
		
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory(directory, {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileName, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
							localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						fileURL,
						localPath,
						function(entry) {
						
						$("li."+pClass+"").html("download "+pClass+" <img src='img/downloadok.png'>");
						$("li."+pClass+"").css("color","green");
						
							/*
							conteggioEsercizi = parseInt(conteggioEsercizi)+1;
															
								if(conteggioEsercizi == totaleEsercizi) {
								alert("scaricati "+conteggioEsercizi+" esercizi");
								sessionStorage.setItem("downloadEsercizi", "ok");
								}
							*/
						},
						function(error) {
							console.log("download error source " + error.source);
							console.log("download error target " + error.target);
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	} //FUNCTION downloadJSON
	
	//DOWNLOAD JSONmulti FUNCTION
	function downloadSottocategorie(directory, fileName, fileURL) {
		
		var fileTransfer = new FileTransfer();
		
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory(directory, {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileName, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
							localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						fileURL,
						localPath,
						function(entry) {
						
						var numElementi = window.sessionStorage.getItem("numElementi");
						numElementi = parseInt(numElementi)-1;							
								if(numElementi == 0) {
								
									$("li.sottocategorie").html("download sottocategorie <img src='img/downloadok.png'>");
									$("li.sottocategorie").css("color","green");
									$("p.downloadComplete").html("<a href='#setupNegozi' class='ui-btn' data-transition='slide'>continua</a>");			
								}
								else {
								sessionStorage.setItem("numElementi", numElementi);
								}
						},
						function(error) {
							alert("error");
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	} //FUNCTION downloadJSONmulti
	
	</script>
	
	<ul style="list-style-type: none">
	<li class="categorie">download categorie...<img src="img/download.gif"></li>
	<li class="sottocategorie">download sottocategorie...<img src="img/download.gif"></li>
	<li class="nome">configurazione ricerca per nome... <img src="img/download.gif"></li>
	<li class="brandEsercizi">configurazione brand... <img src="img/download.gif"></li>
	<li class="brand">download brand... <img src="img/download.gif"></li>
	<li class="position">download posizioni esercizi... <img src="img/download.gif"></li>
	<li class="distance">configurazione distanze... <img src="img/download.gif"></li>
	</ul>
	
	<p class="downloadComplete">attendere...</p>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-theme="a" data-position="fixed">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

</div>
<!-- /PAGE #setupCategorie -->

<!-- PAGE #setupNegozi -->
	<div data-role="page" id="setupNegozi">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#setupNegozi" ).on( "pageshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	
	
	$.ajax({
		url: "http://www.wificomo.com/ccn20/JSONidEsercizi.php?start=0&end=2000",
		dataType: 'json',
		success: function(data) {
		
		var totaleEsercizi = data.length;
		
		window.sessionStorage.setItem("totaleEsercizi", totaleEsercizi);
		window.sessionStorage.setItem("start", 0);
		window.sessionStorage.setItem("iteration", 1);
		
		downloadVetrineInterval();
		}
	});
	
	}); // ON "pageshow"
	
	
	function downloadVetrineInterval() {
	
	var start = window.sessionStorage.getItem('start');
	
	$.ajax({	
		url: "http://www.wificomo.com/ccn20/JSONidEsercizi.php?start="+start+"&end=50",
		dataType: 'json',
		success: function(data) {
		
		var codLingua = window.localStorage.getItem('codLingua');
		
			$.each(data, function(index, info) {
		
			var urlEsercizi = encodeURI("http://www.wificomo.com/ccn20/JSONvetrinaEsercizio.php?language="+codLingua+"&idEsercizio="+info.idEsercizio+"");	
			var fileNameEsercizi = info.idEsercizio+".js";	
			var directoryEsercizi = "ccn/esercizi";
		
			downloadVetrine(directoryEsercizi, fileNameEsercizi, urlEsercizi);
			});
		}
	});
	
	}//FUNCTION
	
	
	//DOWNLOAD JSONmulti FUNCTION
	function downloadVetrine(directory, fileName, fileURL, start, totaleEsercizi) {

		var fileTransfer = new FileTransfer();
		
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
			
			fileSystem.root.getDirectory(directory, {create: true, exclusive: false}, function(dirEntry) {
			
				dirEntry.getFile(fileName, {create: true, exclusive: false}, function(fileEntry) {
										
					var localPath = fileEntry.fullPath;

					if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
							localPath = localPath.substring(7);
					}
					
					fileTransfer.download(
						fileURL,
						localPath,
						function(entry) {
						
						var count = window.sessionStorage.getItem("start");
						var iteration = window.sessionStorage.getItem("iteration");
						
						count = parseInt(count)+1;
						window.sessionStorage.setItem("start", count);
													
							if(count == window.sessionStorage.getItem("totaleEsercizi")) {
							
							$("li.downloadVetrine").html("download vetrine <img src='img/downloadok.png'>");
							$("li.downloadVetrine").css("color","green");	
							$("p.downloadCompleteVetrina").html("<a href='#facebook' class='ui-btn' data-transition='slide'>continua</a>");
							}
							else if(count == parseInt(iteration)*50) {
							
							$("div."+iteration+"").css("background","green");	
							iteration = parseInt(iteration)+1;
							window.sessionStorage.setItem("iteration", iteration);
							
							downloadVetrineInterval();
							}
						},
						function(error) {
							
							var countError = window.sessionStorage.getItem("start");
							var iterationError = window.sessionStorage.getItem("iteration");
						
							countError = parseInt(countError)+1;
							window.sessionStorage.setItem("start", countError);
													
							if(countError == window.sessionStorage.getItem("totaleEsercizi")) {
							
							$("li.downloadVetrine").html("download vetrine <img src='img/downloadok.png'>");
							$("li.downloadVetrine").css("color","green");	
							$("p.downloadCompleteVetrina").html("<a href='#facebook' class='ui-btn' data-transition='slide'>continua</a>");
							}
							else if(countError == parseInt(iterationError)*50) {
							
							$("div."+iterationError+"").css("background","green");	
							iterationError = parseInt(iterationError)+1;
							window.sessionStorage.setItem("iteration", iterationError);
							
							downloadVetrineInterval();
							}
						},
						false,
						{
							headers: {
								"Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
							}
						}
				
					); // end of fileTransfer.download
				}); // end of dirEntry.getFile
			
			}); // fileSystem.root.getDirectory
			
		}); // end of window.requestFileSystem
		
	} //FUNCTION downloadJSONmulti
	
	</script>
	
	<div style="width: 110px, height: 10px, background:white">
	<div class="1" style="width:10px, height:10px, display:inline"></div>
	<div class="2" style="width:10px, height:10px, display:inline"></div>
	<div class="3" style="width:10px, height:10px, display:inline"></div>
	<div class="4" style="width:10px, height:10px, display:inline"></div>
	<div class="5" style="width:10px, height:10px, display:inline"></div>
	<div class="6" style="width:10px, height:10px, display:inline"></div>
	<div class="7" style="width:10px, height:10px, display:inline"></div>
	<div class="8" style="width:10px, height:10px, display:inline"></div>
	<div class="9" style="width:10px, height:10px, display:inline"></div>
	<div class="10" style="width:10px, height:10px, display:inline"></div>
	<div class="11" style="width:10px, height:10px, display:inline"></div>
	</div>
	
	<ul style="list-style-type: none">
	<li class="downloadVetrine">download vetrine...<img src="img/download.gif"></li>
	</ul>
	
	<p class="downloadCompleteVetrina">attendere...</p>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-theme="a" data-position="fixed">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

</div>
<!-- /PAGE #setupNegozi -->

<!-- PAGE #facebook -->
	<div data-role="page" id="facebook">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<div id="fb-root"></div>
	<script>
  
	$( "#facebook" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	FB.init({ appId: "1448410138727682", nativeInterface: CDV.FB, useCachedDialogs: false });
	
	//GET LOGIN STATUS
	FB.getLoginStatus(function(response) {
	
		//CONNESSO
		if (response.status === 'connected') {
		
			FB.api('/me', function(response) {
			$("h2#h2loginFacebook").html("Account Facebook collegato!");
			$("p#ploginFacebook").html("Benvenuto, "+response.name+"");
			$("h2#h2skipFacebook").html("Avanti");
			$("p#pskipFacebook").html("prosegui con il setup dell'applicazione");
			});
		}
		//APP NON AUTORIZZATA
		else if (response.status === 'not_authorized') {
		$("h2#h2loginFacebook").html("Login Facebook");
		$("p#ploginFacebook").html("collega Shopincomo al mio account Foursquare");
		} 
		//NON CONNESSO
		else {
		$("h2#h2loginFacebook").html("Login Facebook");
		$("p#ploginFacebook").html("collega Shopincomo al mio account Facebook");
		}
		
	}, true);
	
	}); //ON "pageshow"
	
	$(document).on("click", 'a.facebook', function(){
	
	FB.login(function(response) {
            
		if (response.authResponse) {
			
			FB.api('/me', function(response) {
			$("h2#h2loginFacebook").html("Account Facebook collegato!");
			$("p#ploginFacebook").html("Benvenuto, "+response.name+"");
			$("a.facebook").attr('href', '#foursquare');
			$("a.facebook").removeClass('facebook');
			$("h2#h2skipFacebook").html("Avanti");
			$("p#pskipFacebook").html("prosegui con il setup dell'applicazione");
			});
		}
		else {
            alert('not logged in');
        }
    },
	{ scope: "email" }
    );
	
	}); //ON "click"
	
</script>
	
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
	
	<ul data-role="listview" data-inset="true">
		<li><a href="#" class="facebook" data-transition="slide">
			<img src="img/collegaFacebook.png">
			<h2 id="h2loginFacebook"></h2>
			<p id="ploginFacebook"></p></a>
		</li>
		<li><a href="#foursquare" id="saltaAFoursquare" data-transition="slide">
			<img src="img/skip.png">
			<h2 id="h2skipFacebook">Prosegui</h2>
			<p id="pskipFacebook">collega account in un secondo momento</p></a>
		</li>
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #facebook -->

<!-- PAGE #foursquare -->
	<div data-role="page" id="foursquare">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#foursquare" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	var tokenFoursquare = window.localStorage.getItem("tokenFoursquare");
	
		if(tokenFoursquare == null) {
		$("h2#h2loginFoursquare").html("Login Foursquare");
		$("p#ploginFoursquare").html("collega Shopincomo al mio account Foursquare");
		}
		else {
		$.getJSON('https://api.foursquare.com/v2/users/self?oauth_token='+tokenFoursquare+'&v=20140304', function(data){
		var user = data['response']['user']['firstName'];
		
		$("h2#h2loginFoursquare").html("Account Foursquare collegato!");
		$("p#ploginFoursquare").html("Benvenuto, "+user+"");
		$("a.foursquare").setAttribute("href", "#twitter");
		$("a.foursquare").removeClass('foursquare');
		$("h2#h2skipFoursquare").html("Avanti");
		$("p#pskipFoursquare").html("prosegui con il setup dell'applicazione");
		});
		
		}
	
	}); //ON "pagebeforeshow"
	
	$(document).on("click", 'a.foursquare', function(){
	
	var ref = window.open('https://foursquare.com/oauth2/authenticate?client_id=4P4XY5XMV2EEGL4THQFXJFMJBTJN4WBNX1VIQGAUWDPHYZZF&response_type=token&redirect_uri=http://www.wificomo.com/ccn20/closeFoursquare.html', '_blank', 'location=no');
	
	ref.addEventListener('loadstart', function(event) {
    closeFoursquare(event.url,ref);
	}); 
	
	function closeFoursquare(loc,ref) {
   
		if (loc.indexOf("www.wificomo.com/ccn20/closeFoursquare.html#") > -1){
		var tokenFoursquare = loc.substring(loc.indexOf("=")+1);
		window.localStorage.setItem("tokenFoursquare", tokenFoursquare);
		
		$.getJSON('https://api.foursquare.com/v2/users/self?oauth_token='+tokenFoursquare+'&v=20140304', function(data){
		var user = data['response']['user']['firstName'];
		$("h2#h2loginFoursquare").html("Account Foursquare collegato!");
		$("p#ploginFoursquare").html("Benvenuto, "+user+"");
		$("a.foursquare").setAttribute("href", "#twitter");
		$("a.foursquare").removeClass('foursquare');
		$("h2#h2skipFoursquare").html("Avanti");
		$("p#pskipFoursquare").html("prosegui con il setup dell'applicazione");
		});
		
		ref.close();
		}
	}
	
	
	}); //ON "click"
		
	</script>
	
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
	
	
	<ul data-role="listview" data-inset="true">
		<li><a href="#" class="foursquare" data-transition="slide">
			<img src="img/collegaFoursquare.png">
			<h2 id="h2loginFoursquare"></h2>
			<p id="ploginFoursquare"></p></a>
		</li>
		<li><a href="#twitter" data-transition="slide">
			<img src="img/skip.png">
			<h2 id="h2skipFoursquare">Prosegui</h2>
			<p id="pskipFoursquare">collega account in un secondo momento</p></a>
		</li>
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #foursquare -->

<!-- PAGE #twitter -->
	<div data-role="page" id="twitter">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#twitter" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	}
	
	var twitterToken = window.localStorage.getItem("twitterToken");
	
		if(twitterToken == null) {
		$("h2#h2loginTwitter").html("Login Twitter");
		$("p#ploginTwitter").html("collega Shopincomo al mio account Twitter");
		}
		else {
		
		var twitterName = window.localStorage.getItem("twitterName");
		
		$("h2#h2loginTwitter").html("Account Twitter collegato!");
		$("p#ploginFoursquare").html("Benvenuto, "+twitterName+"");
		$("a.twitter").setAttribute("href", "#index");
		$("a.twitter").removeClass('twitter');
		$("h2#h2skipTwitter").html("Avanti");
		$("p#pskipTwitter").html("prosegui con il setup dell'applicazione");
		}
	
	}); //ON "pagebeforeshow"
	
	
	$(document).on("click", 'button.twitter', function(){
	
	var ref = window.open('http://www.wificomo.com/twitter/twitterConnect.php', '_blank', 'location=no');
		
		ref.addEventListener('loadstart', function(event) {
        closeTwitter(event.url,ref);
		});  
	
	function closeTwitter(loc,ref) {
   
		if (loc.indexOf("www.wificomo.com/twitter/twitterTokens.php?") > -1){
		
		var twitterToken = loc.substring(loc.indexOf("oauth_token=")+12, loc.indexOf("&"));
		var twitterVerifier = loc.substring(loc.indexOf("oauth_verifier=")+15, loc.indexOf("&t"));
		var twitterName = loc.substring(loc.indexOf("twitterName=")+12);
		twitterName = decodeURIComponent(twitterName);
		
		window.localStorage.setItem("twitterToken", twitterToken);
		window.localStorage.setItem("twitterVerifier", twitterVerifier);
		window.localStorage.setItem("twitterName", twitterName);
		
		$("h2#h2loginTwitter").html("Account Twitter collegato!");
		$("p#ploginFoursquare").html("Benvenuto, "+twitterName+"");
		$("a.twitter").setAttribute("href", "#index");
		$("a.twitter").removeClass('twitter');
		$("h2#h2skipTwitter").html("Avanti");
		$("p#pskipTwitter").html("prosegui con il setup dell'applicazione");
		
		ref.close();
		}
	}
	
	}); //ON "click"
	
	</script>
	
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
	
	<ul data-role="listview" data-inset="true">
		<li><a href="#" class="twitter">
			<img src="img/collegaTwitter.png">
			<h2 id="h2loginTwitter"></h2>
			<p id="ploginTwitter"></p></a>
		</li>
		<li><a href="#index" id="saltaAIndex" data-transition="slide">
			<img src="img/skip.png">
			<h2 id="h2skipTwitter">Prosegui</h2>
			<p id="pskipTwitter">collega account in un secondo momento</p></a>
		</li>
	</ul>
	
	</div>
	<!-- CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->

	</div>
<!-- /PAGE #twitter -->

<!-- Start of page: #vetrinaMappa -->
<div data-role="page" id="vetrinaMappa">

	<!-- /HEADER -->
	<div data-role="header">
	<h1></h1>
	<a href="#index" rel="external" class="ui-btn ui-shadow ui-corner-all ui-icon-home ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div>
	<!-- /HEADER -->

	<div role="main" class="ui-content" >
		
	<script type="text/javascript" charset="utf-8">

	$( document ).on( "pageshow", "#vetrinaMappa", function() {
	
	document.addEventListener("backbutton", onBackKeyDown, false);
		
	function onBackKeyDown(e) {
	e.preventDefault();
	$.mobile.changePage( "index.html", { reloadPage: false, transition: "slide"} );
	}
		
// CARICA FILE VETRINA
	
		var path = window.localStorage.getItem("pathSD");
		var jsonPath = path + "/esercizi/"+idEsercizio+".js";
		var jsonVetrina;
		
		$.ajax({
			url: jsonPath,
			dataType: 'json',
			async: false,
			success: function(data) {
			jsonVetrina = data;
			sessionStorage.setItem('jsonVetrina', JSON.stringify(jsonVetrina));
			}
		}); // AJAX END
	
// NOME ESERCIZIO + INDIRIZZO + DESCRIZIONE
	
		var esercizioLatitude;
		var esercizioLongitude;
		var nomeEsercizioMappa;
		var descrizioneEsercizio;
		var linguaDescrizioneEsercizio;
		var parcheggioVicino;
		var map;
	
		$.each(jsonVetrina, function(index, info) {
				$("h3.nomeEsercizio").html(info.NomeEsercizio);
				$(".indirizzoEsercizio").html(info.Indirizzo+" "+info.Citta);
				$(".descrizioneEsercizio").html(""); // SVUOTA DESCRIZIONE PER PREVENIRE DESCRIZIONI NULLE
				$(".descrizioneEsercizio").html(info.Descrizione);
				 
				esercizioLatitude = info.Latitudine;
				esercizioLongitude = info.Longitudine;
				nomeEsercizioMappa = info.NomeEsercizio;
				descrizioneEsercizio = info.Descrizione;
				linguaDescrizioneEsercizio = info.LinguaDescrizione;
				if (info.Parcheggio != undefined)
				{
				parcheggioVicino = info.Parcheggio.nomeParcheggio+" "+info.Parcheggio.indirizzoParcheggio;
				}
		});
		
//NAVIGATE BUTTON
		
		$( ".navigateEsercizio" ).html("");
		$( ".navigateEsercizio" ).append("<a href='#' geoPosition='"+esercizioLatitude+","+esercizioLongitude+"'class='directions'>Navigazione</a>");

// DESCRIZIONE + TRANSLATE BUTTON
		var codLingua = localStorage.getItem("codLingua");
		if(!(codLingua == 'it' || codLingua == 'en')){
			if(descrizioneEsercizio != undefined)
			{
			$( "#box-descrizioneEsercizio" ).show();
			$( ".traduciDescrizioneEsercizio" ).html("");
			$( ".traduciDescrizioneEsercizio" ).html( "<button class='translate' codLingua='"+codLingua+"' linguaDescrizione='"+linguaDescrizioneEsercizio+"'>Traduci</button>" );	
			}
			else{
			$( "#box-descrizioneEsercizio" ).hide();
			}
		}


// PARCHEGGIO VICINO
		
		if (parcheggioVicino == undefined){
		$( ".parcheggioVicino" ).html("");
		}
		else{
		$( ".parcheggioVicino" ).html("");
		$( ".parcheggioVicino" ).append( "<li class='immagineParcheggio'><img class='imgParcheggio' src='img/parcheggioVicino.png' style='width: 37px; height: 50px;'><p class='nomeParcheggio'>"+parcheggioVicino+"</p></li>" );
		}
		
		
// MAPPA + POSIZIONE UTENTE
	
		//INIZIALIZZAZIONE MAPPA
		
		$( "#map" ).remove();
		var $map = $("<div>", {id: "map", class: "a", style:"width: 1920px; height:400px"});
		$("#mappa").append($map);
		
		map = new L.Map('map');
	
		var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
		L.tileLayer(osmUrl, {minZoom: 13, maxZoom: 18}).addTo(map);
		
		/*
		L.tileLayer('img/como/{z}/{x}/{y}.png', {
		maxZoom: 18
		}).addTo(map);
		*/
		
		map.setView(new L.LatLng(45.80806, 9.08518),14); //MAPPA SU COMO
		
		//BOTTONI CONTROLLO ZOOM
		var controlloZoom = L.control({ position: 'bottomleft' });
		controlloZoom.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'controlloZoom');
			this._div.innerHTML = '<button class="groupMarker"><img src="img/userShop.png"></button><button class="userMarker"><img src="img/userPosition.png"></button>';
			return this._div;
		};
		controlloZoom.addTo(map);
		
		
		var userLatitude;
		var userLongitude;
		var markerUtente;
		var markerEsercizio;
		var group;
		var watchID = null;
		var options = { maximumAge: 1500, timeout: 30000, enableHighAccuracy: true };
      		
		var markerIcon = L.icon({
			iconUrl: 'img/marker-icon.png',
			iconSize:     [25, 41], // size of the icon
			popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
		});
		
		markerEsercizio = L.marker([esercizioLatitude, esercizioLongitude], {icon: markerIcon}).addTo(map).bindPopup(nomeEsercizioMappa);
		
		$(".distanzaEsercizio").html("");
		
		watchID = navigator.geolocation.watchPosition(onSuccess, onErrorPosition, options);
		
// FUNCTION SUCCESS WATCH POSITION

		function onSuccess(position) {
	 		
			userLatitude = position.coords.latitude;
			userLongitude = position.coords.longitude;
	
			var distance = 5000;
			var jsonPositionDir = path + "/position.js";
			$.getJSON(jsonPositionDir, function( jsonPosition ) {
				$.each(jsonPosition, function(index, info) {
					currentDistance = getDistanceFromLatLonInKm(userLatitude,userLongitude,info.latEsercizio,info.lonEsercizio);
					if(distance > currentDistance && info.idEsercizio != idEsercizio)
					{
						distance = currentDistance;
						nearestEsercizio = info.idEsercizio;
					}
				});
				console.log("Nodo vicino: "+nearestEsercizio);
				console.log(distance);
				if(distance < 500)
				{		
					var jsonVetrinaSession = JSON.parse(window.sessionStorage.getItem("jsonVetrina"));
					var obj = jsonVetrinaSession[0];
						if(nearestEsercizio in obj.Distanze){
								$.each(obj.Distanze, function(index, infoDistance) {
									if(infoDistance.idEsercizio == nearestEsercizio){
										var minutes = Math.floor(infoDistance.time / 60);
										var seconds = infoDistance.time - minutes * 60;
										$(".distanzaEsercizio").html(infoDistance.distance+"m - "+minutes+":"+seconds+" min<p class='esercizioVicino'>Ora sei vicino a "+infoDistance.nomeEsercizio+"</p>");
									}
								});
					}
					else{
					$(".distanzaEsercizio").html("+200m");
					}
				}
				else
				{
				$(".distanzaEsercizio").html("Troppo lontato per calcolare");
				}
			}); //END GET JSON POSITION 
	
			var userAccuracy = position.coords.accuracy 

			if (!markerUtente) {
			markerUtente = L.userMarker([userLatitude, userLongitude],{pulsing:true}).bindPopup("Sei qui.").addTo(map);
			markerUtente.setAccuracy(userAccuracy);
			map.setView(new L.LatLng(userLatitude, userLongitude),16);
			}
			markerUtente.setLatLng([userLatitude, userLongitude],{pulsing:true}).update();
	
		} // END ON SUCCESS
	
		function onErrorPosition(error) {
			//alert('code: '    + error.code    + '\n' + 'message: ' + error.message + '\n');
		}

// CLICK ZOOM BUTTONS
	
		$(document).on("click", 'button.groupMarker', function(){
			group = new L.featureGroup([markerEsercizio, markerUtente]);
			map.fitBounds(group.getBounds().pad(0.25));
		});
		
		$(document).on("click", 'button.userMarker', function(){
			map.setView(new L.LatLng(userLatitude, userLongitude),16);
		});
	
	});
	// END OF PAGESHOW

// CLICK DIRECTIONS GOOGLE
	$(document).on("click", 'a.directions', function(){
		geoPosition = $(this).attr('geoPosition');
		directions(geoPosition);
	});
	
// CLICK TRANSLATE GOOGLE
	$(document).on("click", '.translate', function(){
		var descrizioneTranslate = $(".descrizioneEsercizio").text();
		var linguaDescrizione = $(this).attr('linguaDescrizione');
		var codLingua = $(this).attr('codLingua');
		var urlTranslate = encodeURI("http://translate.google.com/#"+linguaDescrizione+"/"+codLingua+"/"+descrizioneTranslate+"");
		var ref = window.open(urlTranslate, '_blank', 'location=yes');
		//ref.addEventListener('loadstart', function() { alert(event.url); });
	});
	
// FUNZIONE DISTANZA NEAREST NODE
	
	function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
  
		var R = 6371; // Radius of the earth in km
  
		var dLat = deg2rad(lat2-lat1);  // deg2rad below
		var dLon = deg2rad(lon2-lon1); 
  
		var a = 
		Math.sin(dLat/2) * Math.sin(dLat/2) +
		Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
		Math.sin(dLon/2) * Math.sin(dLon/2)
		; 
  
		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
		var d = R * c * 1000; // Distance in km
		return Math.round(d);
	}

	function deg2rad(deg) {
		return deg * (Math.PI/180)
	}
		
// FUNZIONE DIRECTIONS GOOGLE
	
	function directions(geoPosition) {
		navigator.google_navigate.navigate(geoPosition, function() {
			console.log('Success');
		}, function(errMsg) {
			console.log("Failed: " + errMsg);
		});
	}
	
	// /FUNZIONE DIRECTIONS
		
	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- MAPPA + INDIRIZZO + DIRECTIONS + PANORAMICA + DISTANZA -->
	<div id="mappa"></div>
	<ul class="funzionalitaMappa">
	<li class="singolaFunzionalitaMappa indirizzoEsercizio"></li>
	<li class="singolaFunzionalitaMappa navigateEsercizio"></li>
	<li class="singolaFunzionalitaMappa distanzaEsercizio"></li>
	</ul>
	<!-- /MAPPA + INDIRIZZO + DIRECTIONS + PANORAMICA + DISTANZA -->
	
	<!-- DESCRIZIONE ESERCIZIO -->
	
	<div id="box-descrizioneEsercizio">
	<p class="descrizioneEsercizio"></p>
	<p class="traduciDescrizioneEsercizio"></p>
	</div>
	<!-- /DESCRIZIONE ESERCIZIO -->
	
	<!-- PARCHEGGIO VICINO ESERCIZIO -->
	
	<ul class="parcheggioVicino">
	</ul>
	<!-- /PARCHEGGIO VICINO ESERCIZIO -->
		
	</div><!-- /content -->

	<div data-role="footer" data-theme="a" data-position="fixed">
		<div data-role="navbar" data-iconpos="top">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-icon="location" class="ui-btn-active ui-state-persist">Mappa</a></li>
                <li><a href="#vetrinaOrari" data-transition="slide" data-icon="clock">Orari</a></li>
                <li><a href="#vetrinaContatti" data-transition="slide" data-icon="phone">Contatti</a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide" data-icon="gear">Statistiche</a></li>
				<!-- <li><a href="#" data-icon="camera">Gallery</a></li> -->
            </ul>
        </div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page vetrinaMappa -->

<!-- Start of page: #vetrinaOrari -->
<div data-role="page" id="vetrinaOrari">

	<div data-role="header">
		<h1></h1>
		<a href="#index" rel="external" class="ui-btn ui-shadow ui-corner-all ui-icon-home ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#vetrinaOrari", function() {
	
	var jsonVetrina = window.sessionStorage.getItem("jsonVetrina");
	
	// NOME ESERCIZIO + ORARI ESERCIZIO
	
	$("ul#orariEsercizio").html("");
	
	$.each(JSON.parse(jsonVetrina), function(index, info) {
				
		$("h3.nomeEsercizio").html(info.NomeEsercizio);
		$("ul#orariEsercizio").append($("<li data-role='list-divider'>Orari di Apertura</li>"));
		$("ul#orariEsercizio").append($("<li>Lunedi: "+info.Orario.lunedi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Martedi: "+info.Orario.martedi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Mercoledi: "+info.Orario.mercoledi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Giovedi: "+info.Orario.giovedi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Venerdi: "+info.Orario.venerdi+"</li>"));
		$("ul#orariEsercizio").append($("<li>Sabato: "+info.Orario.sabato+"</li>"));
		$("ul#orariEsercizio").append($("<li>Domenica: "+info.Orario.domenica+"</li>"));
		$("ul#orariEsercizio").listview("refresh");
							
	});
		
		
	// /NOME ESERCIZIO + ORARI ESERCIZIO
	
	});
	// /PAGEBEFORESHOW
	
	
	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- ORARI -->
	<ul id="orariEsercizio" data-role="listview" data-inset="true">
	</ul>
	<!-- /ORARI -->
			
	</div><!-- /content -->

	<div data-role="footer" data-theme="a" data-position="fixed">
		<div data-role="navbar" data-iconpos="top">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-icon="location" data-direction="reverse">Mappa</a></li>
                <li><a href="#vetrinaOrari" data-transition="slide" data-icon="clock" class="ui-btn-active ui-state-persist">Orari</a></li>
                <li><a href="#vetrinaContatti" data-transition="slide" data-icon="phone">Contatti</a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide" data-icon="gear">Statistiche</a></li>
				<!-- <li><a href="#" data-icon="camera">Gallery</a></li> -->
            </ul>
        </div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page vetrinaOrari -->

<!-- Start of page: #vetrinaContatti -->
<div data-role="page" id="vetrinaContatti">

	<div data-role="header">
		<h1></h1>
		<a href="#index" rel="external" class="ui-btn ui-shadow ui-corner-all ui-icon-home ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#vetrinaContatti", function() {
	
	var jsonVetrina = window.sessionStorage.getItem("jsonVetrina");
	
	// NOME ESERCIZIO + CONTATTI ESERCIZIO
	
	$("ul#contattiEsercizio").html("");
	
	$.each(JSON.parse(jsonVetrina), function(index, info) {
				
		$("h3.nomeEsercizio").html(info.NomeEsercizio);
		$("ul#contattiEsercizio").append($("<li data-role='list-divider'>Contatti</li>"));
		$("ul#contattiEsercizio").append($("<li>Indirizzo: "+info.Indirizzo+" "+info.Citta+"</li>"));
		if (info.Telefono != undefined){$("ul#contattiEsercizio").append($("<li>Telefono: "+info.Telefono+"</li>"))};
		if (info.Website != undefined){$("ul#contattiEsercizio").append($("<li>Website: "+info.Website+"</li>"))};
		if (info.Email != undefined){$("ul#contattiEsercizio").append($("<li>Email: "+info.Email+"</li>"))};
		if (info.Facebook != undefined){$("ul#contattiEsercizio").append($("<li>Facebook: "+info.Facebook+"</li>"))};
		if (info.Twitter != undefined){$("ul#contattiEsercizio").append($("<li>Twitter: "+info.Twitter+"</li>"))};
		if (info.Foursquare != undefined){$("ul#contattiEsercizio").append($("<li>Foursquare: "+info.Foursquare+"</li>"))};
		$("ul#contattiEsercizio").listview("refresh");
							
	});
		
		
	// /NOME ESERCIZIO + CONTATTI ESERCIZIO
	});
	// /PAGEBEFORESHOW
	
	
	
	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- CONTATTI ESERCIZIO -->
	
	<ul id="contattiEsercizio" data-role="listview" data-inset="true">
	</ul>
	
	<!-- /CONTATTI ESERCIZIO -->
			
	</div><!-- /content -->

	<div data-role="footer" data-theme="a" data-position="fixed">
		<div data-role="navbar" data-iconpos="top">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-icon="location" data-direction="reverse">Mappa</a></li>
                <li><a href="#vetrinaOrari" data-transition="slide" data-icon="clock" data-direction="reverse">Orari</a></li>
                <li><a href="#vetrinaContatti" data-transition="slide" data-icon="phone" class="ui-btn-active ui-state-persist">Contatti</a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide" data-icon="gear">Statistiche</a></li>
				<!-- <li><a href="#" data-icon="camera">Gallery</a></li> -->
            </ul>
        </div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page vetrinaContatti -->

<!-- Start of page: #vetrinaStatistiche -->
<div data-role="page" id="vetrinaStatistiche">

	<div data-role="header">
		<h1></h1>
		<a href="#index" rel="external" class="ui-btn ui-shadow ui-corner-all ui-icon-home ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div><!-- /header -->

	<div role="main" class="ui-content" >
		
	
	<script type="text/javascript" charset="utf-8">
	
	$( document ).on( "pagebeforeshow", "#vetrinaStatistiche", function() {
	
	var jsonVetrina = window.sessionStorage.getItem("jsonVetrina");
	
	// NOME ESERCIZIO + STATISTICHE
	
	var checkStatistiche;
	var idEsercizio;
	
		$.each(JSON.parse(jsonVetrina), function(index, info) {
				
			$("h3.nomeEsercizio").html(info.NomeEsercizio);
			idEsercizio = info.idEsercizio;
			checkStatistiche = info.Statistiche;
			
			
		});
	
	if(checkStatistiche == "si"){
	
		//var checkConnection = checkConnection();
		//if (checkConnection =! "No_network")
		//{
			$(function () {
			var chart;
			var perShapeGradient = {
				x1: 0,
				y1: 0,
				x2: 1,
				y2: 0
			};

			$(document).ready(function() {
		
			$.getJSON("http://www.wificomo.com/ccn20/JSONbarchart.php", {idNegozio: idEsercizio}, function( json ) {
		
				jsonFilter = jQuery.grep(json, function (v) {
				return v.intervallo == "15giorni";
				console.log("filtro base: ");
				console.log(jsonFilter);
				});
		
				chart = new Highcharts.Chart({
					chart: {
						renderTo: 'barChart',
						type: 'column',
						marginRight: 10,
						marginBottom: 25
					},
					colors: [{
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(80, 135, 226)'],
							[1, 'rgb(25, 70, 148)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(120, 202, 248)'],
							[1, 'rgb(46, 150, 208)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(136, 219, 5)'],
							[1, 'rgb(112, 180, 5)']
							]}, 
					],
					title: {
						text: '',
						x: -20, //center
					},
					subtitle: {
						text: '',
						x: -20
					},
					xAxis: {
						startOnTick: false,
						endOnTick:false,
						type: 'datetime',
						tickInterval: 4 * 24 * 3600 * 1000,
						minTickInterval: 86400000,
						dateTimeLabelFormats: {
						day: '%e %m'
						}
					},
					yAxis: {
						allowDecimals: false,
						stackLabels: {
						enabled: true
						},
						title: {
						text: 'Voti'
						}
					},
					tooltip: {
						enabled: true,
						xDateFormat: '%d-%m-%Y'
					},
					plotOptions: {
						column: {
						stacking: 'normal',
						pointWidth:10,
						dataLabels: {
										enabled: false,
										color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black'
									}
						}
					},
					legend: {
						layout: 'horizontal',
						align: 'center',
						verticalAlign: 'top',
						borderWidth: 0,
						enabled: true,
						floating: true
					},
					series: jsonFilter
				});

				
			$( "button#intervallo" ).click(function() {
			var intervallo = $(this).attr('value');
			jsonFilter = jQuery.grep(json, function (v) {
			return v.intervallo == intervallo;
			});
		
			chart = new Highcharts.Chart({
					chart: {
						renderTo: 'barChart',
						type: 'column',
						marginRight: 10,
						marginBottom: 25
					},
					colors: [{
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(80, 135, 226)'],
							[1, 'rgb(25, 70, 148)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(120, 202, 248)'],
							[1, 'rgb(46, 150, 208)']
							]
						}, {
						linearGradient: perShapeGradient,
						stops: [
							[0, 'rgb(136, 219, 5)'],
							[1, 'rgb(112, 180, 5)']
							]}, 
					],
					title: {
						text: '',
						x: -20, //center
					},
					subtitle: {
						text: '',
						x: -20
					},
					xAxis: {
						startOnTick: false,
						endOnTick:false,
						type: 'datetime',
						tickInterval: 4 * 24 * 3600 * 1000,
						minTickInterval: 86400000,
						dateTimeLabelFormats: {
						day: '%e %m'
						}
					},
					yAxis: {
						allowDecimals: false,
						stackLabels: {
						enabled: true
						},
						title: {
						text: 'Voti'
						}
					},
					tooltip: {
						enabled: true,
						xDateFormat: '%d-%m-%Y'
					},
					plotOptions: {
						column: {
						stacking: 'normal',
						pointWidth:10,
						dataLabels: {
										enabled: false,
										color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black'
									}
						}
					},
					legend: {
						layout: 'horizontal',
						align: 'center',
						verticalAlign: 'top',
						borderWidth: 0,
						enabled: true,
						floating: true
					},
					series: jsonFilter
				});

		
		
			});
		
			});
			});
		
			});
		
		//}
		//else{
		//$("#checkStatistiche").html("Questa funzionalità è disponibile solo se collegati alla rete 3G o WiFi");
		//}
	
	}
	else{
	$("#checkStatistiche").html("Il negoziante non permette la visualizzazione pubblica delle statistiche");
	}
		
	// /NOME ESERCIZIO + STATISTICHE
	
	});
	// /PAGEBEFORESHOW

	</script>
	
	<!-- NOME ESERCIZIO -->
	
	<div id="box-nomeEsercizio">
	<h3 class="nomeEsercizio"></h3>
	</div>
	
	<!-- /NOME ESERCIZIO -->
	
	<!-- STATISTICHE -->
	<div id="box-statisticheEsercizio">
	<p id="checkStatistiche"></p>
	<div id="barChart" style="width: 1920px; height:450px"></div>
	<div>
	<button id="intervallo" value="7giorni">7 giorni</button>
	<button id="intervallo"value="15giorni">15 giorni</button>
	<button id="intervallo" value="30giorni">30 giorni</button>
	</div>
	</div>
	<!-- /STATISTICHE -->
	
		
	</div><!-- /content -->

	<div data-role="footer" data-theme="a" data-position="fixed">
		<div data-role="navbar" data-iconpos="top">
            <ul>
                <li><a href="#vetrinaMappa" data-transition="slide" data-icon="location" data-direction="reverse">Mappa</a></li>
                <li><a href="#vetrinaOrari" data-transition="slide" data-icon="clock" data-direction="reverse">Orari</a></li>
                <li><a href="#vetrinaContatti" data-transition="slide" data-icon="phone" data-direction="reverse">Contatti</a></li>
				<li><a href="#vetrinaStatistiche" data-transition="slide" data-icon="gear" class="ui-btn-active ui-state-persist">Statistiche</a></li>
				<!-- <li><a href="#" data-icon="camera">Gallery</a></li> -->
            </ul>
        </div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page vetrinaStatistiche -->

<!-- PAGE #credits -->
<div data-role="page" id="credits">

	<!-- /HEADER -->
	<div data-role="header">
		<h1></h1>
		<a href="#index" class="ui-btn ui-icon-home ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" data-transition="slide" data-direction="reverse">indietro</a>
	</div>
	<!-- /HEADER -->
	
	<!-- CONTENT -->
	<div role="main" class="ui-content" >
	
	<script>   
	$( "#credits" ).on( "pagebeforeshow", function() {	
	
	document.addEventListener("backbutton", function(e){
    
		navigator.app.backHistory()
		
	}, false);
	
	});
		
	</script>
	
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

	</div>
	<!-- /CONTENT -->

	<!-- FOOTER -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		<h4></h4>
	</div>
	<!-- /FOOTER -->
	
</div><!-- /PAGE #credits -->

</body>
</html>